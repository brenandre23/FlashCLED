2025-11-15 20:45:32,963 - INFO - STARTING H3-OPTIMIZED PIPELINE...
2025-11-15 20:45:32,963 - INFO - Root Directory: C:\Users\Brenan\Desktop\Thesis\Scratch
2025-11-15 20:45:33,009 - INFO - 
============================================================
>>> RUNNING: 01_build_static_features.py
============================================================
2025-11-15 20:45:35,409 - ERROR - Grid generation failed: too many values to unpack (expected 2)
Traceback (most recent call last):
  File "C:\Users\Brenan\Desktop\Thesis\Scratch\scripts\01_build_static_features.py", line 165, in main
    data_config, features_config = utils.load_configs()
ValueError: too many values to unpack (expected 2)
2025-11-15 20:45:35,693 - ERROR - --- FAILED: 01_build_static_features.py ---
2025-11-15 20:45:35,693 - ERROR - Exit Code: 1
2025-11-15 20:45:35,694 - CRITICAL - Pipeline HALTED due to error in 01_build_static_features.py.
2025-11-15 20:48:31,577 - INFO - STARTING H3-OPTIMIZED PIPELINE...
2025-11-15 20:48:31,577 - INFO - Root Directory: C:\Users\Brenan\Desktop\Thesis\Scratch
2025-11-15 20:48:31,597 - INFO - 
============================================================
>>> RUNNING: 01_build_static_features.py
============================================================
2025-11-15 20:48:34,115 - INFO - ============================================================
2025-11-15 20:48:34,115 - INFO - STEP 1: H3 GRID GENERATION
2025-11-15 20:48:34,116 - INFO - ============================================================
2025-11-15 20:48:34,235 - INFO - Skipping generation. To regenerate: TRUNCATE TABLE car_cewp.features_static;
2025-11-15 20:48:34,511 - INFO - --- SUCCESS: 01_build_static_features.py ---
2025-11-15 20:48:34,512 - INFO - 
============================================================
>>> RUNNING: 02_fetch_acled.py
============================================================
2025-11-15 20:48:37,260 - INFO - --- SUCCESS: 02_fetch_acled.py ---
2025-11-15 20:48:37,261 - INFO - 
============================================================
>>> RUNNING: 03_fetch_temporal_roads_HYBRID.py
============================================================
2025-11-15 20:48:39,703 - INFO - ============================================================
2025-11-15 20:48:39,703 - INFO - STEP 2: TEMPORAL ROAD & CITY INGESTION (PARALLELIZED)
2025-11-15 20:48:39,704 - INFO - ============================================================
2025-11-15 20:48:39,705 - INFO - Resolution: 5 | Cores: 15
2025-11-15 20:48:39,785 - INFO - 
============================================================
2025-11-15 20:48:39,785 - INFO - INGESTION COMPLETE
2025-11-15 20:48:39,786 - INFO - ============================================================
2025-11-15 20:48:40,065 - INFO - --- SUCCESS: 03_fetch_temporal_roads_HYBRID.py ---
2025-11-15 20:48:40,065 - INFO - 
============================================================
>>> RUNNING: 04_calculate_distances.py
============================================================
2025-11-15 20:48:42,517 - INFO - ============================================================
2025-11-15 20:48:42,517 - INFO - STEP 3b: DISTANCE CALCULATIONS (H3 K-RING)
2025-11-15 20:48:42,518 - INFO - ============================================================
2025-11-15 20:48:42,519 - INFO - Ensuring distance columns exist in schema...
2025-11-15 20:48:42,573 - INFO - 
--- Calculating Temporal Road Distances ---
2025-11-15 20:48:42,625 - INFO - 
--- Calculating City Distances ---
2025-11-15 20:48:42,639 - INFO - 
--- Verification Statistics ---
2025-11-15 20:48:42,642 - INFO -   Roads 2010: 2,600 cells | Avg: 530.49 km | Max: 735.00 km
2025-11-15 20:48:42,643 - INFO -   Roads 2015: 3,377 cells | Avg: 313.75 km | Max: 735.00 km
2025-11-15 20:48:42,647 - INFO -   Roads 2020: 3,398 cells | Avg: 287.67 km | Max: 735.00 km
2025-11-15 20:48:42,651 - INFO -   Roads 2025: 3,398 cells | Avg: 287.67 km | Max: 735.00 km
2025-11-15 20:48:42,652 - INFO -   Cities:    3,407 cells | Avg: 25.44 km | Max: 191.10 km
2025-11-15 20:48:42,652 - INFO - 
============================================================
2025-11-15 20:48:42,654 - INFO - DISTANCE PROCESSING COMPLETE
2025-11-15 20:48:42,654 - INFO - ============================================================
2025-11-15 20:48:42,926 - INFO - --- SUCCESS: 04_calculate_distances.py ---
2025-11-15 20:48:42,926 - INFO - 
============================================================
>>> RUNNING: 05_fetch_iom.py
============================================================
2025-11-15 20:48:58,556 - INFO - --- SUCCESS: 05_fetch_iom.py ---
2025-11-15 20:48:58,556 - INFO - 
============================================================
>>> RUNNING: 06_calculate_terrain.py
============================================================
2025-11-15 20:49:01,216 - ERROR - Failed: too many values to unpack (expected 2)
Traceback (most recent call last):
  File "C:\Users\Brenan\Desktop\Thesis\Scratch\scripts\06_calculate_terrain.py", line 324, in main
    data_config, features_config = utils.load_configs()
ValueError: too many values to unpack (expected 2)
2025-11-15 20:49:01,505 - ERROR - --- FAILED: 06_calculate_terrain.py ---
2025-11-15 20:49:01,505 - ERROR - Exit Code: 1
2025-11-15 20:49:01,506 - CRITICAL - Pipeline HALTED due to error in 06_calculate_terrain.py.
2025-11-15 20:53:56,335 - INFO - STARTING H3-OPTIMIZED PIPELINE...
2025-11-15 20:53:56,336 - INFO - Root Directory: C:\Users\Brenan\Desktop\Thesis\Scratch
2025-11-15 20:53:56,352 - INFO - 
============================================================
>>> RUNNING: 01_build_static_features.py
============================================================
2025-11-15 20:53:58,707 - INFO - ============================================================
2025-11-15 20:53:58,707 - INFO - STEP 1: H3 GRID GENERATION
2025-11-15 20:53:58,708 - INFO - ============================================================
2025-11-15 20:53:58,750 - INFO -  CHECKPOINT: Grid already exists (3,407 cells).
2025-11-15 20:53:58,750 - INFO - Skipping generation. To regenerate: TRUNCATE TABLE car_cewp.features_static;
2025-11-15 20:53:59,021 - INFO - --- SUCCESS: 01_build_static_features.py ---
2025-11-15 20:53:59,021 - INFO - 
============================================================
>>> RUNNING: 02_fetch_acled.py
============================================================
2025-11-15 20:54:01,737 - INFO - --- SUCCESS: 02_fetch_acled.py ---
2025-11-15 20:54:01,737 - INFO - 
============================================================
>>> RUNNING: 03_fetch_temporal_roads_HYBRID.py
============================================================
2025-11-15 20:54:04,218 - INFO - ============================================================
2025-11-15 20:54:04,218 - INFO - STEP 2: TEMPORAL ROAD & CITY INGESTION (PARALLELIZED)
2025-11-15 20:54:04,220 - INFO - ============================================================
2025-11-15 20:54:04,220 - INFO - Resolution: 5 | Cores: 15
2025-11-15 20:54:04,414 - INFO - 
============================================================
2025-11-15 20:54:04,414 - INFO - INGESTION COMPLETE
2025-11-15 20:54:04,414 - INFO - ============================================================
2025-11-15 20:54:04,680 - INFO - --- SUCCESS: 03_fetch_temporal_roads_HYBRID.py ---
2025-11-15 20:54:04,680 - INFO - 
============================================================
>>> RUNNING: 04_calculate_distances.py
============================================================
2025-11-15 20:54:07,045 - INFO - ============================================================
2025-11-15 20:54:07,045 - INFO - STEP 3b: DISTANCE CALCULATIONS (H3 K-RING)
2025-11-15 20:54:07,046 - INFO - ============================================================
2025-11-15 20:54:07,048 - INFO - Ensuring distance columns exist in schema...
2025-11-15 20:54:07,106 - INFO - 
--- Calculating Temporal Road Distances ---
2025-11-15 20:54:07,156 - INFO - 
--- Calculating City Distances ---
2025-11-15 20:54:07,168 - INFO - 
--- Verification Statistics ---
2025-11-15 20:54:07,170 - INFO -   Roads 2010: 2,600 cells | Avg: 530.49 km | Max: 735.00 km
2025-11-15 20:54:07,171 - INFO -   Roads 2015: 3,377 cells | Avg: 313.75 km | Max: 735.00 km
2025-11-15 20:54:07,171 - INFO -   Roads 2020: 3,398 cells | Avg: 287.67 km | Max: 735.00 km
2025-11-15 20:54:07,172 - INFO -   Roads 2025: 3,398 cells | Avg: 287.67 km | Max: 735.00 km
2025-11-15 20:54:07,173 - INFO -   Cities:    3,407 cells | Avg: 25.44 km | Max: 191.10 km
2025-11-15 20:54:07,173 - INFO - 
============================================================
2025-11-15 20:54:07,176 - INFO - DISTANCE PROCESSING COMPLETE
2025-11-15 20:54:07,176 - INFO - ============================================================
2025-11-15 20:54:07,493 - INFO - --- SUCCESS: 04_calculate_distances.py ---
2025-11-15 20:54:07,493 - INFO - 
============================================================
>>> RUNNING: 05_fetch_iom.py
============================================================
2025-11-15 20:54:09,793 - INFO - DTMApi client initialized with api_version=v3, timeout=30s, max_retries=3, retry_delay=1s
2025-11-15 20:54:09,793 - INFO - Fetching IOM DTM data for: Central African Republic...
2025-11-15 20:54:09,794 - INFO - Attempting to fetch Admin 2 (Sub-prefecture) data...
2025-11-15 20:54:11,566 - INFO - Successfully fetched 3735 records from https://dtmapi.iom.int/v3/displacement/admin2
2025-11-15 20:54:11,617 - INFO -   Columns: ['id', 'operation', 'admin0Name', 'admin0Pcode', 'admin1Name', 'admin1Pcode', 'admin2Name', 'admin2Pcode', 'numPresentIdpInd', 'reportingDate', 'yearReportingDate', 'monthReportingDate', 'roundNumber', 'displacementReason', 'numberMales', 'numberFemales', 'idpOriginAdmin1Name', 'idpOriginAdmin1Pcode', 'assessmentType', 'Granularity']
2025-11-15 20:54:11,871 - INFO - --- SUCCESS: 05_fetch_iom.py ---
2025-11-15 20:54:11,871 - INFO - 
============================================================
>>> RUNNING: 06_calculate_terrain.py
============================================================
2025-11-15 20:54:14,281 - INFO - ============================================================
2025-11-15 20:54:14,281 - INFO - STEP 4: TERRAIN & GEOGRAPHY (OPTIMIZED - 15 CORES)
2025-11-15 20:54:14,282 - INFO - ============================================================
2025-11-15 20:54:14,289 - INFO - Calculating terrain derivatives (Vectorized)...
2025-11-15 20:54:17,195 - INFO -   Vectorized Slope...
2025-11-15 20:54:37,028 - INFO -   Vectorized TRI...
2025-11-15 20:58:50,573 - INFO - 
--- Calculating Zonal Stats (Parallel: 15 cores) ---
2025-11-15 20:58:55,231 - INFO - 
--- Calculating Geographic Distances ---
2025-11-15 20:58:55,250 - INFO - 
TERRAIN PROCESSING COMPLETE
2025-11-15 20:58:56,321 - INFO - --- SUCCESS: 06_calculate_terrain.py ---
2025-11-15 20:58:56,332 - INFO - 
============================================================
>>> RUNNING: 07_fetch_population.py
============================================================
2025-11-15 20:59:01,610 - INFO - ============================================================
2025-11-15 20:59:01,610 - INFO - STEP 7b: POPULATION INGESTION (2015-2030)
2025-11-15 20:59:01,612 - INFO - ============================================================
2025-11-15 20:59:01,661 - INFO - Loading H3 Grid...
2025-11-15 20:59:01,844 - INFO -    Year 2015 exists in DB. Skipping.
2025-11-15 20:59:01,846 - INFO -    Year 2016 exists in DB. Skipping.
2025-11-15 20:59:01,848 - INFO -    Year 2017 exists in DB. Skipping.
2025-11-15 20:59:01,850 - INFO -    Year 2018 exists in DB. Skipping.
2025-11-15 20:59:01,851 - INFO -    Year 2019 exists in DB. Skipping.
2025-11-15 20:59:01,853 - INFO -    Year 2020 exists in DB. Skipping.
2025-11-15 20:59:01,853 - INFO -    Year 2021 exists in DB. Skipping.
2025-11-15 20:59:01,856 - INFO -    Year 2022 exists in DB. Skipping.
2025-11-15 20:59:01,856 - INFO -    Year 2023 exists in DB. Skipping.
2025-11-15 20:59:01,856 - INFO -    Year 2024 exists in DB. Skipping.
2025-11-15 20:59:01,863 - INFO -    Year 2025 exists in DB. Skipping.
2025-11-15 20:59:01,866 - INFO -    Year 2026 exists in DB. Skipping.
2025-11-15 20:59:01,868 - INFO -    Year 2027 exists in DB. Skipping.
2025-11-15 20:59:01,869 - INFO -    Year 2028 exists in DB. Skipping.
2025-11-15 20:59:01,871 - INFO -    Year 2029 exists in DB. Skipping.
2025-11-15 20:59:01,872 - INFO -    Year 2030 exists in DB. Skipping.
2025-11-15 20:59:01,873 - INFO - 
============================================================
2025-11-15 20:59:01,873 - INFO - POPULATION INGESTION COMPLETE
2025-11-15 20:59:01,874 - INFO - ============================================================
2025-11-15 20:59:02,291 - INFO - --- SUCCESS: 07_fetch_population.py ---
2025-11-15 20:59:02,292 - INFO - 
============================================================
>>> RUNNING: 08_build_feature_matrix.py
============================================================
2025-11-15 20:59:05,113 - INFO - ============================================================
2025-11-15 20:59:05,113 - INFO - STEP 8: BUILD FEATURE MATRIX (SAMPLE)
2025-11-15 20:59:05,114 - INFO - ============================================================
2025-11-15 20:59:05,116 - INFO - Running temporal selection demonstration...
2025-11-15 20:59:05,165 - INFO - 
Logic Verification:
  observation_date selected_column_logic
0       2011-06-15     dist_road_2010_km
1       2016-03-20     dist_road_2015_km
2       2021-09-10     dist_road_2020_km
3       2024-11-01     dist_road_2025_km

2025-11-15 20:59:05,165 - INFO - Fetching sample matrix (Limit 10,000 rows)...
2025-11-15 20:59:05,171 - ERROR - Feature matrix build failed: (psycopg2.errors.SyntaxError) syntax error at or near "LIMIT"
LINE 52:      LIMIT 10000
              ^

[SQL: 
    WITH time_spine AS (
        -- Create all time periods (Bi-weekly)
        SELECT 
            generate_series(
                '2010-01-01'::date,
                '2025-01-01'::date,
                '14 days'::interval
            )::date AS period_start
    ),
    
    spatial_temporal_grid AS (
        -- Create H3 × Time grid
        SELECT 
            f.h3_index,
            f.geometry,
            ts.period_start,
            (ts.period_start + INTERVAL '14 days')::date AS period_end,
            
            -- 1. Population (Join logic handled below)
            COALESCE(p.pop_count, 0) as population, 

            -- 2. Temporal Road Selection (CASE WHEN logic)
            -- This prevents "data leakage" from future roads
            CASE 
                WHEN ts.period_start >= '2022-07-01' THEN f.dist_road_2025_km
                WHEN ts.period_start >= '2017-07-01' THEN f.dist_road_2020_km
                WHEN ts.period_start >= '2012-07-01' THEN f.dist_road_2015_km
                ELSE f.dist_road_2010_km
            END AS dist_road_km,
            
            -- 3. Static features
            f.dist_city_km,
            f.dist_capital_km,
            f.dist_border_km,
            f.elevation_mean,
            f.slope_mean,
            f.terrain_ruggedness_mean
            
        FROM car_cewp.features_static f
        CROSS JOIN time_spine ts
        
        -- Join Population: matches closest available year
        -- Note: GREATEST(2015, ...) handles pre-2015 dates by backfilling with 2015 data
        LEFT JOIN car_cewp.population_h3 p 
            ON f.h3_index = p.h3_index 
            AND p.year = GREATEST(2015, EXTRACT(YEAR FROM ts.period_start))
    )
    
    SELECT * FROM spatial_temporal_grid
    ORDER BY h3_index, period_start;
     LIMIT 10000]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.SyntaxError: syntax error at or near "LIMIT"
LINE 52:      LIMIT 10000
              ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Brenan\Desktop\Thesis\Scratch\scripts\08_build_feature_matrix.py", line 138, in main
    df = pd.read_sql(sample_sql, engine)
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\pandas\io\sql.py", line 736, in read_sql
    return pandas_sql.read_query(
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\pandas\io\sql.py", line 1848, in read_query
    result = self.execute(sql, params)
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\pandas\io\sql.py", line 1671, in execute
    return self.con.exec_driver_sql(sql, *args)
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\base.py", line 1779, in exec_driver_sql
    ret = self._execute_context(
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.SyntaxError) syntax error at or near "LIMIT"
LINE 52:      LIMIT 10000
              ^

[SQL: 
    WITH time_spine AS (
        -- Create all time periods (Bi-weekly)
        SELECT 
            generate_series(
                '2010-01-01'::date,
                '2025-01-01'::date,
                '14 days'::interval
            )::date AS period_start
    ),
    
    spatial_temporal_grid AS (
        -- Create H3 × Time grid
        SELECT 
            f.h3_index,
            f.geometry,
            ts.period_start,
            (ts.period_start + INTERVAL '14 days')::date AS period_end,
            
            -- 1. Population (Join logic handled below)
            COALESCE(p.pop_count, 0) as population, 

            -- 2. Temporal Road Selection (CASE WHEN logic)
            -- This prevents "data leakage" from future roads
            CASE 
                WHEN ts.period_start >= '2022-07-01' THEN f.dist_road_2025_km
                WHEN ts.period_start >= '2017-07-01' THEN f.dist_road_2020_km
                WHEN ts.period_start >= '2012-07-01' THEN f.dist_road_2015_km
                ELSE f.dist_road_2010_km
            END AS dist_road_km,
            
            -- 3. Static features
            f.dist_city_km,
            f.dist_capital_km,
            f.dist_border_km,
            f.elevation_mean,
            f.slope_mean,
            f.terrain_ruggedness_mean
            
        FROM car_cewp.features_static f
        CROSS JOIN time_spine ts
        
        -- Join Population: matches closest available year
        -- Note: GREATEST(2015, ...) handles pre-2015 dates by backfilling with 2015 data
        LEFT JOIN car_cewp.population_h3 p 
            ON f.h3_index = p.h3_index 
            AND p.year = GREATEST(2015, EXTRACT(YEAR FROM ts.period_start))
    )
    
    SELECT * FROM spatial_temporal_grid
    ORDER BY h3_index, period_start;
     LIMIT 10000]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-15 20:59:05,532 - ERROR - --- FAILED: 08_build_feature_matrix.py ---
2025-11-15 20:59:05,532 - ERROR - Exit Code: 1
2025-11-15 20:59:05,533 - CRITICAL - Pipeline HALTED due to error in 08_build_feature_matrix.py.
2025-11-15 21:02:33,838 - INFO - STARTING H3-OPTIMIZED PIPELINE...
2025-11-15 21:02:33,838 - INFO - Root Directory: C:\Users\Brenan\Desktop\Thesis\Scratch
2025-11-15 21:02:33,855 - INFO - 
============================================================
>>> RUNNING: 01_build_static_features.py
============================================================
2025-11-15 21:02:36,189 - INFO - ============================================================
2025-11-15 21:02:36,189 - INFO - STEP 1: H3 GRID GENERATION
2025-11-15 21:02:36,190 - INFO - ============================================================
2025-11-15 21:02:36,253 - INFO -  CHECKPOINT: Grid already exists (3,407 cells).
2025-11-15 21:02:36,253 - INFO - Skipping generation. To regenerate: TRUNCATE TABLE car_cewp.features_static;
2025-11-15 21:02:36,518 - INFO - --- SUCCESS: 01_build_static_features.py ---
2025-11-15 21:02:36,519 - INFO - 
============================================================
>>> RUNNING: 02_fetch_acled.py
============================================================
2025-11-15 21:02:39,066 - INFO - --- SUCCESS: 02_fetch_acled.py ---
2025-11-15 21:02:39,067 - INFO - 
============================================================
>>> RUNNING: 03_fetch_temporal_roads_HYBRID.py
============================================================
2025-11-15 21:02:41,423 - INFO - ============================================================
2025-11-15 21:02:41,700 - INFO - STEP 2: TEMPORAL ROAD & CITY INGESTION (PARALLELIZED)
2025-11-15 21:02:41,702 - INFO - ============================================================
2025-11-15 21:02:41,705 - INFO - Resolution: 5 | Cores: 15
2025-11-15 21:02:41,743 - INFO -  Cities already exist (1,103 cells). Skipping.
2025-11-15 21:02:41,746 - INFO - 
 2010 roads already exist (1 cells). Skipping.
2025-11-15 21:02:41,748 - INFO - 
 2015 roads already exist (6 cells). Skipping.
2025-11-15 21:02:41,750 - INFO - 
 2020 roads already exist (7 cells). Skipping.
2025-11-15 21:02:41,752 - INFO - 
 2025 roads already exist (8 cells). Skipping.
2025-11-15 21:02:41,752 - INFO - 
============================================================
2025-11-15 21:02:41,752 - INFO - INGESTION COMPLETE
2025-11-15 21:02:41,753 - INFO - ============================================================
2025-11-15 21:02:42,028 - INFO - --- SUCCESS: 03_fetch_temporal_roads_HYBRID.py ---
2025-11-15 21:02:42,029 - INFO - 
============================================================
>>> RUNNING: 04_calculate_distances.py
============================================================
2025-11-15 21:02:44,517 - INFO - ============================================================
2025-11-15 21:02:44,517 - INFO - STEP 3b: DISTANCE CALCULATIONS (H3 K-RING)
2025-11-15 21:02:44,518 - INFO - ============================================================
2025-11-15 21:02:44,519 - INFO - Ensuring distance columns exist in schema...
2025-11-15 21:02:44,669 - INFO -  Schema columns ready.
2025-11-15 21:02:44,669 - INFO - 
--- Calculating Temporal Road Distances ---
2025-11-15 21:02:44,691 - INFO -  CHECKPOINT: 2010 already calculated (2,600 cells). Skipping.
2025-11-15 21:02:44,695 - INFO -  CHECKPOINT: 2015 already calculated (3,377 cells). Skipping.
2025-11-15 21:02:44,700 - INFO -  CHECKPOINT: 2020 already calculated (3,398 cells). Skipping.
2025-11-15 21:02:44,704 - INFO -  CHECKPOINT: 2025 already calculated (3,398 cells). Skipping.
2025-11-15 21:02:44,704 - INFO - 
--- Calculating City Distances ---
2025-11-15 21:02:44,708 - INFO -  CHECKPOINT: Cities already calculated (3,407 cells). Skipping.
2025-11-15 21:02:44,708 - INFO - 
--- Verification Statistics ---
2025-11-15 21:02:44,718 - INFO -   Roads 2010: 2,600 cells | Avg: 530.49 km | Max: 735.00 km
2025-11-15 21:02:44,719 - INFO -   Roads 2015: 3,377 cells | Avg: 313.75 km | Max: 735.00 km
2025-11-15 21:02:44,719 - INFO -   Roads 2020: 3,398 cells | Avg: 287.67 km | Max: 735.00 km
2025-11-15 21:02:44,727 - INFO -   Roads 2025: 3,398 cells | Avg: 287.67 km | Max: 735.00 km
2025-11-15 21:02:44,728 - INFO -   Cities:    3,407 cells | Avg: 25.44 km | Max: 191.10 km
2025-11-15 21:02:44,734 - INFO - 
============================================================
2025-11-15 21:02:44,734 - INFO - DISTANCE PROCESSING COMPLETE
2025-11-15 21:02:44,737 - INFO - ============================================================
2025-11-15 21:02:45,086 - INFO - --- SUCCESS: 04_calculate_distances.py ---
2025-11-15 21:02:45,086 - INFO - 
============================================================
>>> RUNNING: 05_fetch_iom.py
============================================================
2025-11-15 21:02:47,664 - INFO - DTMApi client initialized with api_version=v3, timeout=30s, max_retries=3, retry_delay=1s
2025-11-15 21:02:47,664 - INFO - Fetching IOM DTM data for: Central African Republic...
2025-11-15 21:02:47,665 - INFO - Attempting to fetch Admin 2 (Sub-prefecture) data...
2025-11-15 21:03:00,828 - INFO - Successfully fetched 3735 records from https://dtmapi.iom.int/v3/displacement/admin2
2025-11-15 21:03:00,840 - INFO -  Success! Found 3,735 Admin 2 records.
2025-11-15 21:03:00,865 - INFO -  Data saved to: C:\Users\Brenan\Desktop\Thesis\Scratch\data\processed\iom_displacement_data.csv
2025-11-15 21:03:00,865 - INFO -   Columns: ['id', 'operation', 'admin0Name', 'admin0Pcode', 'admin1Name', 'admin1Pcode', 'admin2Name', 'admin2Pcode', 'numPresentIdpInd', 'reportingDate', 'yearReportingDate', 'monthReportingDate', 'roundNumber', 'displacementReason', 'numberMales', 'numberFemales', 'idpOriginAdmin1Name', 'idpOriginAdmin1Pcode', 'assessmentType', 'Granularity']
2025-11-15 21:03:01,142 - INFO - --- SUCCESS: 05_fetch_iom.py ---
2025-11-15 21:03:01,142 - INFO - 
============================================================
>>> RUNNING: 06_calculate_terrain.py
============================================================
2025-11-15 21:03:03,578 - INFO - ============================================================
2025-11-15 21:03:03,578 - INFO - STEP 4: TERRAIN & GEOGRAPHY (OPTIMIZED - 15 CORES)
2025-11-15 21:03:03,579 - INFO - ============================================================
2025-11-15 21:03:03,600 - INFO - 
--- Calculating Zonal Stats (Parallel: 15 cores) ---
2025-11-15 21:03:07,177 - INFO - 
--- Calculating Geographic Distances ---
2025-11-15 21:03:07,196 - INFO - 
TERRAIN PROCESSING COMPLETE
2025-11-15 21:03:07,467 - INFO - --- SUCCESS: 06_calculate_terrain.py ---
2025-11-15 21:03:07,467 - INFO - 
============================================================
>>> RUNNING: 07_fetch_population.py
============================================================
2025-11-15 21:03:09,865 - INFO - ============================================================
2025-11-15 21:03:09,865 - INFO - STEP 7b: POPULATION INGESTION (2015-2030)
2025-11-15 21:03:09,868 - INFO - ============================================================
2025-11-15 21:03:09,903 - INFO - Loading H3 Grid...
2025-11-15 21:03:09,990 - INFO -    Year 2015 exists in DB. Skipping.
2025-11-15 21:03:09,991 - INFO -    Year 2016 exists in DB. Skipping.
2025-11-15 21:03:09,993 - INFO -    Year 2017 exists in DB. Skipping.
2025-11-15 21:03:09,994 - INFO -    Year 2018 exists in DB. Skipping.
2025-11-15 21:03:09,995 - INFO -    Year 2019 exists in DB. Skipping.
2025-11-15 21:03:09,996 - INFO -    Year 2020 exists in DB. Skipping.
2025-11-15 21:03:09,997 - INFO -    Year 2021 exists in DB. Skipping.
2025-11-15 21:03:09,998 - INFO -    Year 2022 exists in DB. Skipping.
2025-11-15 21:03:09,999 - INFO -    Year 2023 exists in DB. Skipping.
2025-11-15 21:03:10,000 - INFO -    Year 2024 exists in DB. Skipping.
2025-11-15 21:03:10,002 - INFO -    Year 2025 exists in DB. Skipping.
2025-11-15 21:03:10,003 - INFO -    Year 2026 exists in DB. Skipping.
2025-11-15 21:03:10,004 - INFO -    Year 2027 exists in DB. Skipping.
2025-11-15 21:03:10,005 - INFO -    Year 2028 exists in DB. Skipping.
2025-11-15 21:03:10,006 - INFO -    Year 2029 exists in DB. Skipping.
2025-11-15 21:03:10,008 - INFO -    Year 2030 exists in DB. Skipping.
2025-11-15 21:03:10,009 - INFO - 
============================================================
2025-11-15 21:03:10,009 - INFO - POPULATION INGESTION COMPLETE
2025-11-15 21:03:10,010 - INFO - ============================================================
2025-11-15 21:03:10,315 - INFO - --- SUCCESS: 07_fetch_population.py ---
2025-11-15 21:03:10,316 - INFO - 
============================================================
>>> RUNNING: 08_build_feature_matrix.py
============================================================
2025-11-15 21:03:12,924 - INFO - ============================================================
2025-11-15 21:03:12,925 - INFO - STEP 8: BUILD FEATURE MATRIX (SAMPLE)
2025-11-15 21:03:12,926 - INFO - ============================================================
2025-11-15 21:03:12,926 - INFO - Running temporal selection demonstration...
2025-11-15 21:03:12,968 - INFO - 
Logic Verification:
  observation_date selected_column_logic
0       2011-06-15     dist_road_2010_km
1       2016-03-20     dist_road_2015_km
2       2021-09-10     dist_road_2020_km
3       2024-11-01     dist_road_2025_km

2025-11-15 21:03:12,969 - INFO - Fetching sample matrix (Limit 10,000 rows)...
2025-11-15 21:03:12,972 - ERROR - Feature matrix build failed: (psycopg2.errors.UndefinedFunction) operator does not exist: bigint = text
LINE 44:             ON f.h3_index = p.h3_index 
                                   ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: 
    WITH time_spine AS (
        -- Create all time periods (Bi-weekly)
        SELECT 
            generate_series(
                '2010-01-01'::date,
                '2025-01-01'::date,
                '14 days'::interval
            )::date AS period_start
    ),
    
    spatial_temporal_grid AS (
        -- Create H3 × Time grid
        SELECT 
            f.h3_index,
            f.geometry,
            ts.period_start,
            (ts.period_start + INTERVAL '14 days')::date AS period_end,
            
            -- 1. Population (Join logic handled below)
            COALESCE(p.pop_count, 0) as population, 

            -- 2. Temporal Road Selection (CASE WHEN logic)
            CASE 
                WHEN ts.period_start >= '2022-07-01' THEN f.dist_road_2025_km
                WHEN ts.period_start >= '2017-07-01' THEN f.dist_road_2020_km
                WHEN ts.period_start >= '2012-07-01' THEN f.dist_road_2015_km
                ELSE f.dist_road_2010_km
            END AS dist_road_km,
            
            -- 3. Static features
            f.dist_city_km,
            f.dist_capital_km,
            f.dist_border_km,
            f.elevation_mean,
            f.slope_mean,
            f.terrain_ruggedness_mean
            
        FROM car_cewp.features_static f
        CROSS JOIN time_spine ts
        
        -- Join Population: matches closest available year
        LEFT JOIN car_cewp.population_h3 p 
            ON f.h3_index = p.h3_index 
            AND p.year = GREATEST(2015, EXTRACT(YEAR FROM ts.period_start))
    )
    
    SELECT * FROM spatial_temporal_grid
    ORDER BY h3_index, period_start
     LIMIT 10000;]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedFunction: operator does not exist: bigint = text
LINE 44:             ON f.h3_index = p.h3_index 
                                   ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Brenan\Desktop\Thesis\Scratch\scripts\08_build_feature_matrix.py", line 130, in main
    df = pd.read_sql(sample_sql, engine)
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\pandas\io\sql.py", line 736, in read_sql
    return pandas_sql.read_query(
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\pandas\io\sql.py", line 1848, in read_query
    result = self.execute(sql, params)
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\pandas\io\sql.py", line 1671, in execute
    return self.con.exec_driver_sql(sql, *args)
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\base.py", line 1779, in exec_driver_sql
    ret = self._execute_context(
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedFunction) operator does not exist: bigint = text
LINE 44:             ON f.h3_index = p.h3_index 
                                   ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: 
    WITH time_spine AS (
        -- Create all time periods (Bi-weekly)
        SELECT 
            generate_series(
                '2010-01-01'::date,
                '2025-01-01'::date,
                '14 days'::interval
            )::date AS period_start
    ),
    
    spatial_temporal_grid AS (
        -- Create H3 × Time grid
        SELECT 
            f.h3_index,
            f.geometry,
            ts.period_start,
            (ts.period_start + INTERVAL '14 days')::date AS period_end,
            
            -- 1. Population (Join logic handled below)
            COALESCE(p.pop_count, 0) as population, 

            -- 2. Temporal Road Selection (CASE WHEN logic)
            CASE 
                WHEN ts.period_start >= '2022-07-01' THEN f.dist_road_2025_km
                WHEN ts.period_start >= '2017-07-01' THEN f.dist_road_2020_km
                WHEN ts.period_start >= '2012-07-01' THEN f.dist_road_2015_km
                ELSE f.dist_road_2010_km
            END AS dist_road_km,
            
            -- 3. Static features
            f.dist_city_km,
            f.dist_capital_km,
            f.dist_border_km,
            f.elevation_mean,
            f.slope_mean,
            f.terrain_ruggedness_mean
            
        FROM car_cewp.features_static f
        CROSS JOIN time_spine ts
        
        -- Join Population: matches closest available year
        LEFT JOIN car_cewp.population_h3 p 
            ON f.h3_index = p.h3_index 
            AND p.year = GREATEST(2015, EXTRACT(YEAR FROM ts.period_start))
    )
    
    SELECT * FROM spatial_temporal_grid
    ORDER BY h3_index, period_start
     LIMIT 10000;]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-15 21:03:13,350 - ERROR - --- FAILED: 08_build_feature_matrix.py ---
2025-11-15 21:03:13,350 - ERROR - Exit Code: 1
2025-11-15 21:03:13,351 - CRITICAL - Pipeline HALTED due to error in 08_build_feature_matrix.py.
2025-11-15 21:03:29,275 - INFO - STARTING H3-OPTIMIZED PIPELINE...
2025-11-15 21:03:29,275 - INFO - Root Directory: C:\Users\Brenan\Desktop\Thesis\Scratch
2025-11-15 21:03:29,294 - INFO - 
============================================================
>>> RUNNING: 01_build_static_features.py
============================================================
2025-11-15 21:03:31,757 - INFO - ============================================================
2025-11-15 21:03:31,758 - INFO - STEP 1: H3 GRID GENERATION
2025-11-15 21:03:31,759 - INFO - ============================================================
2025-11-15 21:03:31,918 - INFO -  CHECKPOINT: Grid already exists (3,407 cells).
2025-11-15 21:03:31,918 - INFO - Skipping generation. To regenerate: TRUNCATE TABLE car_cewp.features_static;
2025-11-15 21:03:32,222 - INFO - --- SUCCESS: 01_build_static_features.py ---
2025-11-15 21:03:32,225 - INFO - 
============================================================
>>> RUNNING: 02_fetch_acled.py
============================================================
2025-11-15 21:03:34,836 - INFO - --- SUCCESS: 02_fetch_acled.py ---
2025-11-15 21:03:34,837 - INFO - 
============================================================
>>> RUNNING: 03_fetch_temporal_roads_HYBRID.py
============================================================
2025-11-15 21:03:37,269 - INFO - ============================================================
2025-11-15 21:03:37,269 - INFO - STEP 2: TEMPORAL ROAD & CITY INGESTION (PARALLELIZED)
2025-11-15 21:03:37,270 - INFO - ============================================================
2025-11-15 21:03:37,272 - INFO - Resolution: 5 | Cores: 15
2025-11-15 21:03:37,310 - INFO -  Cities already exist (1,103 cells). Skipping.
2025-11-15 21:03:37,312 - INFO - 
 2010 roads already exist (1 cells). Skipping.
2025-11-15 21:03:37,313 - INFO - 
 2015 roads already exist (6 cells). Skipping.
2025-11-15 21:03:37,314 - INFO - 
 2020 roads already exist (7 cells). Skipping.
2025-11-15 21:03:37,316 - INFO - 
 2025 roads already exist (8 cells). Skipping.
2025-11-15 21:03:37,316 - INFO - 
============================================================
2025-11-15 21:03:37,316 - INFO - INGESTION COMPLETE
2025-11-15 21:03:37,319 - INFO - ============================================================
2025-11-15 21:03:37,599 - INFO - --- SUCCESS: 03_fetch_temporal_roads_HYBRID.py ---
2025-11-15 21:03:37,599 - INFO - 
============================================================
>>> RUNNING: 04_calculate_distances.py
============================================================
2025-11-15 21:03:40,233 - INFO - ============================================================
2025-11-15 21:03:40,234 - INFO - STEP 3b: DISTANCE CALCULATIONS (H3 K-RING)
2025-11-15 21:03:40,235 - INFO - ============================================================
2025-11-15 21:03:40,236 - INFO - Ensuring distance columns exist in schema...
2025-11-15 21:03:40,287 - INFO -  Schema columns ready.
2025-11-15 21:03:40,287 - INFO - 
--- Calculating Temporal Road Distances ---
2025-11-15 21:03:40,300 - INFO -  CHECKPOINT: 2010 already calculated (2,600 cells). Skipping.
2025-11-15 21:03:40,304 - INFO -  CHECKPOINT: 2015 already calculated (3,377 cells). Skipping.
2025-11-15 21:03:40,307 - INFO -  CHECKPOINT: 2020 already calculated (3,398 cells). Skipping.
2025-11-15 21:03:40,310 - INFO -  CHECKPOINT: 2025 already calculated (3,398 cells). Skipping.
2025-11-15 21:03:40,311 - INFO - 
--- Calculating City Distances ---
2025-11-15 21:03:40,314 - INFO -  CHECKPOINT: Cities already calculated (3,407 cells). Skipping.
2025-11-15 21:03:40,314 - INFO - 
--- Verification Statistics ---
2025-11-15 21:03:40,315 - INFO -   Roads 2010: 2,600 cells | Avg: 530.49 km | Max: 735.00 km
2025-11-15 21:03:40,316 - INFO -   Roads 2015: 3,377 cells | Avg: 313.75 km | Max: 735.00 km
2025-11-15 21:03:40,316 - INFO -   Roads 2020: 3,398 cells | Avg: 287.67 km | Max: 735.00 km
2025-11-15 21:03:40,317 - INFO -   Roads 2025: 3,398 cells | Avg: 287.67 km | Max: 735.00 km
2025-11-15 21:03:40,318 - INFO -   Cities:    3,407 cells | Avg: 25.44 km | Max: 191.10 km
2025-11-15 21:03:40,318 - INFO - 
============================================================
2025-11-15 21:03:40,318 - INFO - DISTANCE PROCESSING COMPLETE
2025-11-15 21:03:40,318 - INFO - ============================================================
2025-11-15 21:03:40,725 - INFO - --- SUCCESS: 04_calculate_distances.py ---
2025-11-15 21:03:40,725 - INFO - 
============================================================
>>> RUNNING: 05_fetch_iom.py
============================================================
2025-11-15 21:03:43,229 - INFO - DTMApi client initialized with api_version=v3, timeout=30s, max_retries=3, retry_delay=1s
2025-11-15 21:03:43,230 - INFO - Fetching IOM DTM data for: Central African Republic...
2025-11-15 21:03:43,231 - INFO - Attempting to fetch Admin 2 (Sub-prefecture) data...
2025-11-15 21:03:44,936 - INFO - Successfully fetched 3735 records from https://dtmapi.iom.int/v3/displacement/admin2
2025-11-15 21:03:44,947 - INFO -  Success! Found 3,735 Admin 2 records.
2025-11-15 21:03:44,973 - INFO -  Data saved to: C:\Users\Brenan\Desktop\Thesis\Scratch\data\processed\iom_displacement_data.csv
2025-11-15 21:03:44,973 - INFO -   Columns: ['id', 'operation', 'admin0Name', 'admin0Pcode', 'admin1Name', 'admin1Pcode', 'admin2Name', 'admin2Pcode', 'numPresentIdpInd', 'reportingDate', 'yearReportingDate', 'monthReportingDate', 'roundNumber', 'displacementReason', 'numberMales', 'numberFemales', 'idpOriginAdmin1Name', 'idpOriginAdmin1Pcode', 'assessmentType', 'Granularity']
2025-11-15 21:03:45,263 - INFO - --- SUCCESS: 05_fetch_iom.py ---
2025-11-15 21:03:45,263 - INFO - 
============================================================
>>> RUNNING: 06_calculate_terrain.py
============================================================
2025-11-15 21:03:47,758 - INFO - ============================================================
2025-11-15 21:03:47,758 - INFO - STEP 4: TERRAIN & GEOGRAPHY (OPTIMIZED - 15 CORES)
2025-11-15 21:03:47,759 - INFO - ============================================================
2025-11-15 21:03:47,761 - INFO -  DEM cached: C:\Users\Brenan\Desktop\Thesis\Scratch\data\processed\copernicus_dem_90m.tif
2025-11-15 21:03:47,761 - INFO -  Terrain derivatives cached (Slope & TRI). Skipping.
2025-11-15 21:03:47,762 - INFO - 
--- Calculating Zonal Stats (Parallel: 15 cores) ---
2025-11-15 21:03:47,797 - INFO -  Zonal stats already exist. Skipping.
2025-11-15 21:03:51,490 - INFO - 
--- Calculating Geographic Distances ---
2025-11-15 21:03:51,492 - INFO -  Capital Distance exists. Skipping.
2025-11-15 21:03:51,492 - INFO -  Border Distance exists. Skipping.
2025-11-15 21:03:51,492 - INFO - 
TERRAIN PROCESSING COMPLETE
2025-11-15 21:03:51,809 - INFO - --- SUCCESS: 06_calculate_terrain.py ---
2025-11-15 21:03:51,809 - INFO - 
============================================================
>>> RUNNING: 07_fetch_population.py
============================================================
2025-11-15 21:03:54,205 - INFO - ============================================================
2025-11-15 21:03:54,205 - INFO - STEP 7b: POPULATION INGESTION (2015-2030)
2025-11-15 21:03:54,206 - INFO - ============================================================
2025-11-15 21:03:54,244 - INFO - Loading H3 Grid...
2025-11-15 21:03:54,323 - INFO -    Year 2015 exists in DB. Skipping.
2025-11-15 21:03:54,325 - INFO -    Year 2016 exists in DB. Skipping.
2025-11-15 21:03:54,327 - INFO -    Year 2017 exists in DB. Skipping.
2025-11-15 21:03:54,328 - INFO -    Year 2018 exists in DB. Skipping.
2025-11-15 21:03:54,329 - INFO -    Year 2019 exists in DB. Skipping.
2025-11-15 21:03:54,330 - INFO -    Year 2020 exists in DB. Skipping.
2025-11-15 21:03:54,331 - INFO -    Year 2021 exists in DB. Skipping.
2025-11-15 21:03:54,332 - INFO -    Year 2022 exists in DB. Skipping.
2025-11-15 21:03:54,333 - INFO -    Year 2023 exists in DB. Skipping.
2025-11-15 21:03:54,334 - INFO -    Year 2024 exists in DB. Skipping.
2025-11-15 21:03:54,335 - INFO -    Year 2025 exists in DB. Skipping.
2025-11-15 21:03:54,336 - INFO -    Year 2026 exists in DB. Skipping.
2025-11-15 21:03:54,337 - INFO -    Year 2027 exists in DB. Skipping.
2025-11-15 21:03:54,338 - INFO -    Year 2028 exists in DB. Skipping.
2025-11-15 21:03:54,339 - INFO -    Year 2029 exists in DB. Skipping.
2025-11-15 21:03:54,340 - INFO -    Year 2030 exists in DB. Skipping.
2025-11-15 21:03:54,342 - INFO - 
============================================================
2025-11-15 21:03:54,345 - INFO - POPULATION INGESTION COMPLETE
2025-11-15 21:03:54,345 - INFO - ============================================================
2025-11-15 21:03:54,621 - INFO - --- SUCCESS: 07_fetch_population.py ---
2025-11-15 21:03:54,622 - INFO - 
============================================================
>>> RUNNING: 08_build_feature_matrix.py
============================================================
2025-11-15 21:03:56,940 - INFO - ============================================================
2025-11-15 21:03:56,940 - INFO - STEP 8: BUILD FEATURE MATRIX (SAMPLE)
2025-11-15 21:03:56,941 - INFO - ============================================================
2025-11-15 21:03:56,943 - INFO - Running temporal selection demonstration...
2025-11-15 21:03:56,987 - INFO - 
Logic Verification:
  observation_date selected_column_logic
0       2011-06-15     dist_road_2010_km
1       2016-03-20     dist_road_2015_km
2       2021-09-10     dist_road_2020_km
3       2024-11-01     dist_road_2025_km

2025-11-15 21:03:56,987 - INFO - Fetching sample matrix (Limit 10,000 rows)...
2025-11-15 21:03:56,990 - ERROR - Feature matrix build failed: (psycopg2.errors.UndefinedFunction) operator does not exist: bigint = text
LINE 44:             ON f.h3_index = p.h3_index 
                                   ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: 
    WITH time_spine AS (
        -- Create all time periods (Bi-weekly)
        SELECT 
            generate_series(
                '2010-01-01'::date,
                '2025-01-01'::date,
                '14 days'::interval
            )::date AS period_start
    ),
    
    spatial_temporal_grid AS (
        -- Create H3 × Time grid
        SELECT 
            f.h3_index,
            f.geometry,
            ts.period_start,
            (ts.period_start + INTERVAL '14 days')::date AS period_end,
            
            -- 1. Population (Join logic handled below)
            COALESCE(p.pop_count, 0) as population, 

            -- 2. Temporal Road Selection (CASE WHEN logic)
            CASE 
                WHEN ts.period_start >= '2022-07-01' THEN f.dist_road_2025_km
                WHEN ts.period_start >= '2017-07-01' THEN f.dist_road_2020_km
                WHEN ts.period_start >= '2012-07-01' THEN f.dist_road_2015_km
                ELSE f.dist_road_2010_km
            END AS dist_road_km,
            
            -- 3. Static features
            f.dist_city_km,
            f.dist_capital_km,
            f.dist_border_km,
            f.elevation_mean,
            f.slope_mean,
            f.terrain_ruggedness_mean
            
        FROM car_cewp.features_static f
        CROSS JOIN time_spine ts
        
        -- Join Population: matches closest available year
        LEFT JOIN car_cewp.population_h3 p 
            ON f.h3_index = p.h3_index 
            AND p.year = GREATEST(2015, EXTRACT(YEAR FROM ts.period_start))
    )
    
    SELECT * FROM spatial_temporal_grid
    ORDER BY h3_index, period_start
     LIMIT 10000;]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedFunction: operator does not exist: bigint = text
LINE 44:             ON f.h3_index = p.h3_index 
                                   ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Brenan\Desktop\Thesis\Scratch\scripts\08_build_feature_matrix.py", line 130, in main
    df = pd.read_sql(sample_sql, engine)
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\pandas\io\sql.py", line 736, in read_sql
    return pandas_sql.read_query(
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\pandas\io\sql.py", line 1848, in read_query
    result = self.execute(sql, params)
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\pandas\io\sql.py", line 1671, in execute
    return self.con.exec_driver_sql(sql, *args)
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\base.py", line 1779, in exec_driver_sql
    ret = self._execute_context(
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedFunction) operator does not exist: bigint = text
LINE 44:             ON f.h3_index = p.h3_index 
                                   ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

[SQL: 
    WITH time_spine AS (
        -- Create all time periods (Bi-weekly)
        SELECT 
            generate_series(
                '2010-01-01'::date,
                '2025-01-01'::date,
                '14 days'::interval
            )::date AS period_start
    ),
    
    spatial_temporal_grid AS (
        -- Create H3 × Time grid
        SELECT 
            f.h3_index,
            f.geometry,
            ts.period_start,
            (ts.period_start + INTERVAL '14 days')::date AS period_end,
            
            -- 1. Population (Join logic handled below)
            COALESCE(p.pop_count, 0) as population, 

            -- 2. Temporal Road Selection (CASE WHEN logic)
            CASE 
                WHEN ts.period_start >= '2022-07-01' THEN f.dist_road_2025_km
                WHEN ts.period_start >= '2017-07-01' THEN f.dist_road_2020_km
                WHEN ts.period_start >= '2012-07-01' THEN f.dist_road_2015_km
                ELSE f.dist_road_2010_km
            END AS dist_road_km,
            
            -- 3. Static features
            f.dist_city_km,
            f.dist_capital_km,
            f.dist_border_km,
            f.elevation_mean,
            f.slope_mean,
            f.terrain_ruggedness_mean
            
        FROM car_cewp.features_static f
        CROSS JOIN time_spine ts
        
        -- Join Population: matches closest available year
        LEFT JOIN car_cewp.population_h3 p 
            ON f.h3_index = p.h3_index 
            AND p.year = GREATEST(2015, EXTRACT(YEAR FROM ts.period_start))
    )
    
    SELECT * FROM spatial_temporal_grid
    ORDER BY h3_index, period_start
     LIMIT 10000;]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-15 21:03:57,265 - ERROR - --- FAILED: 08_build_feature_matrix.py ---
2025-11-15 21:03:57,265 - ERROR - Exit Code: 1
2025-11-15 21:03:57,266 - CRITICAL - Pipeline HALTED due to error in 08_build_feature_matrix.py.
2025-11-15 21:09:07,952 - INFO - STARTING H3-OPTIMIZED PIPELINE...
2025-11-15 21:09:07,952 - INFO - Root Directory: C:\Users\Brenan\Desktop\Thesis\Scratch
2025-11-15 21:09:07,965 - INFO - Configuration files loaded and validated.
2025-11-15 21:09:07,966 - INFO - 
============================================================
>>> RUNNING: 01_build_static_features.py
============================================================
2025-11-15 21:09:10,283 - INFO - ============================================================
2025-11-15 21:09:10,283 - INFO - STEP 1: H3 GRID GENERATION
2025-11-15 21:09:10,283 - INFO - ============================================================
2025-11-15 21:09:10,439 - INFO -  CHECKPOINT: Grid already exists (3,407 cells).
2025-11-15 21:09:10,439 - INFO - Skipping generation. To regenerate: TRUNCATE TABLE car_cewp.features_static;
2025-11-15 21:09:10,714 - INFO - --- SUCCESS: 01_build_static_features.py ---
2025-11-15 21:09:10,714 - INFO - 
============================================================
>>> RUNNING: 02_fetch_acled.py
============================================================
2025-11-15 21:09:13,221 - INFO - --- SUCCESS: 02_fetch_acled.py ---
2025-11-15 21:09:13,221 - INFO - 
============================================================
>>> RUNNING: 03_fetch_temporal_roads_HYBRID.py
============================================================
2025-11-15 21:09:15,503 - INFO - ============================================================
2025-11-15 21:09:15,503 - INFO - STEP 2: TEMPORAL ROAD & CITY INGESTION (PARALLELIZED)
2025-11-15 21:09:15,503 - INFO - ============================================================
2025-11-15 21:09:15,518 - INFO - Resolution: 5 | Cores: 15
2025-11-15 21:09:15,541 - INFO -  Cities already exist (1,103 cells). Skipping.
2025-11-15 21:09:15,556 - INFO - 
 2010 roads already exist (1 cells). Skipping.
2025-11-15 21:09:15,556 - INFO - 
 2015 roads already exist (6 cells). Skipping.
2025-11-15 21:09:15,556 - INFO - 
 2020 roads already exist (7 cells). Skipping.
2025-11-15 21:09:15,556 - INFO - 
 2025 roads already exist (8 cells). Skipping.
2025-11-15 21:09:15,556 - INFO - 
============================================================
2025-11-15 21:09:15,556 - INFO - INGESTION COMPLETE
2025-11-15 21:09:15,556 - INFO - ============================================================
2025-11-15 21:09:15,824 - INFO - --- SUCCESS: 03_fetch_temporal_roads_HYBRID.py ---
2025-11-15 21:09:15,824 - INFO - 
============================================================
>>> RUNNING: 04_calculate_distances.py
============================================================
2025-11-15 21:09:18,133 - INFO - ============================================================
2025-11-15 21:09:18,134 - INFO - STEP 3b: DISTANCE CALCULATIONS (H3 K-RING)
2025-11-15 21:09:18,135 - INFO - ============================================================
2025-11-15 21:09:18,138 - INFO - Ensuring distance columns exist in schema...
2025-11-15 21:09:18,279 - INFO -  Schema columns ready.
2025-11-15 21:09:18,280 - INFO - 
--- Calculating Temporal Road Distances ---
2025-11-15 21:09:18,291 - INFO -  CHECKPOINT: 2010 already calculated (2,600 cells). Skipping.
2025-11-15 21:09:18,294 - INFO -  CHECKPOINT: 2015 already calculated (3,377 cells). Skipping.
2025-11-15 21:09:18,296 - INFO -  CHECKPOINT: 2020 already calculated (3,398 cells). Skipping.
2025-11-15 21:09:18,299 - INFO -  CHECKPOINT: 2025 already calculated (3,398 cells). Skipping.
2025-11-15 21:09:18,299 - INFO - 
--- Calculating City Distances ---
2025-11-15 21:09:18,300 - INFO -  CHECKPOINT: Cities already calculated (3,407 cells). Skipping.
2025-11-15 21:09:18,300 - INFO - 
--- Verification Statistics ---
2025-11-15 21:09:18,300 - INFO -   Roads 2010: 2,600 cells | Avg: 530.49 km | Max: 735.00 km
2025-11-15 21:09:18,300 - INFO -   Roads 2015: 3,377 cells | Avg: 313.75 km | Max: 735.00 km
2025-11-15 21:09:18,300 - INFO -   Roads 2020: 3,398 cells | Avg: 287.67 km | Max: 735.00 km
2025-11-15 21:09:18,300 - INFO -   Roads 2025: 3,398 cells | Avg: 287.67 km | Max: 735.00 km
2025-11-15 21:09:18,300 - INFO -   Cities:    3,407 cells | Avg: 25.44 km | Max: 191.10 km
2025-11-15 21:09:18,300 - INFO - 
============================================================
2025-11-15 21:09:18,300 - INFO - DISTANCE PROCESSING COMPLETE
2025-11-15 21:09:18,300 - INFO - ============================================================
2025-11-15 21:09:18,566 - INFO - --- SUCCESS: 04_calculate_distances.py ---
2025-11-15 21:09:18,566 - INFO - 
============================================================
>>> RUNNING: 05_fetch_iom.py
============================================================
2025-11-15 21:09:20,791 - INFO - DTMApi client initialized with api_version=v3, timeout=30s, max_retries=3, retry_delay=1s
2025-11-15 21:09:20,791 - INFO - Fetching IOM DTM data for: Central African Republic...
2025-11-15 21:09:20,791 - INFO - Attempting to fetch Admin 2 (Sub-prefecture) data...
2025-11-15 21:09:22,656 - INFO - Successfully fetched 3735 records from https://dtmapi.iom.int/v3/displacement/admin2
2025-11-15 21:09:22,656 - INFO -  Success! Found 3,735 Admin 2 records.
2025-11-15 21:09:22,690 - INFO -  Data saved to: C:\Users\Brenan\Desktop\Thesis\Scratch\data\processed\iom_displacement_data.csv
2025-11-15 21:09:22,691 - INFO -   Columns: ['id', 'operation', 'admin0Name', 'admin0Pcode', 'admin1Name', 'admin1Pcode', 'admin2Name', 'admin2Pcode', 'numPresentIdpInd', 'reportingDate', 'yearReportingDate', 'monthReportingDate', 'roundNumber', 'displacementReason', 'numberMales', 'numberFemales', 'idpOriginAdmin1Name', 'idpOriginAdmin1Pcode', 'assessmentType', 'Granularity']
2025-11-15 21:09:22,939 - INFO - --- SUCCESS: 05_fetch_iom.py ---
2025-11-15 21:09:22,939 - INFO - 
============================================================
>>> RUNNING: 06_calculate_terrain.py
============================================================
2025-11-15 21:09:25,315 - INFO - ============================================================
2025-11-15 21:09:25,315 - INFO - STEP 4: TERRAIN & GEOGRAPHY (OPTIMIZED - 15 CORES)
2025-11-15 21:09:25,315 - INFO - ============================================================
2025-11-15 21:09:25,315 - INFO -  DEM cached: C:\Users\Brenan\Desktop\Thesis\Scratch\data\processed\copernicus_dem_90m.tif
2025-11-15 21:09:25,315 - INFO -  Terrain derivatives cached (Slope & TRI). Skipping.
2025-11-15 21:09:25,315 - INFO - 
--- Calculating Zonal Stats (Parallel: 15 cores) ---
2025-11-15 21:09:25,455 - INFO -  Zonal stats already exist. Skipping.
2025-11-15 21:09:29,035 - INFO - 
--- Calculating Geographic Distances ---
2025-11-15 21:09:29,035 - INFO -  Capital Distance exists. Skipping.
2025-11-15 21:09:29,035 - INFO -  Border Distance exists. Skipping.
2025-11-15 21:09:29,035 - INFO - 
TERRAIN PROCESSING COMPLETE
2025-11-15 21:09:29,304 - INFO - --- SUCCESS: 06_calculate_terrain.py ---
2025-11-15 21:09:29,304 - INFO - 
============================================================
>>> RUNNING: 07_fetch_population.py
============================================================
2025-11-15 21:09:31,706 - INFO - ============================================================
2025-11-15 21:09:31,706 - INFO - STEP 7b: POPULATION INGESTION (2015-2030)
2025-11-15 21:09:31,706 - INFO - ============================================================
2025-11-15 21:09:31,741 - INFO - Loading H3 Grid...
2025-11-15 21:09:31,815 - INFO -    Year 2015 exists in DB. Skipping.
2025-11-15 21:09:31,825 - INFO -    Year 2016 exists in DB. Skipping.
2025-11-15 21:09:31,825 - INFO -    Year 2017 exists in DB. Skipping.
2025-11-15 21:09:31,825 - INFO -    Year 2018 exists in DB. Skipping.
2025-11-15 21:09:31,825 - INFO -    Year 2019 exists in DB. Skipping.
2025-11-15 21:09:31,825 - INFO -    Year 2020 exists in DB. Skipping.
2025-11-15 21:09:31,825 - INFO -    Year 2021 exists in DB. Skipping.
2025-11-15 21:09:31,825 - INFO -    Year 2022 exists in DB. Skipping.
2025-11-15 21:09:31,825 - INFO -    Year 2023 exists in DB. Skipping.
2025-11-15 21:09:31,825 - INFO -    Year 2024 exists in DB. Skipping.
2025-11-15 21:09:31,825 - INFO -    Year 2025 exists in DB. Skipping.
2025-11-15 21:09:31,825 - INFO -    Year 2026 exists in DB. Skipping.
2025-11-15 21:09:31,825 - INFO -    Year 2027 exists in DB. Skipping.
2025-11-15 21:09:31,825 - INFO -    Year 2028 exists in DB. Skipping.
2025-11-15 21:09:31,841 - INFO -    Year 2029 exists in DB. Skipping.
2025-11-15 21:09:31,841 - INFO -    Year 2030 exists in DB. Skipping.
2025-11-15 21:09:31,841 - INFO - 
============================================================
2025-11-15 21:09:31,841 - INFO - POPULATION INGESTION COMPLETE
2025-11-15 21:09:31,841 - INFO - ============================================================
2025-11-15 21:09:32,117 - INFO - --- SUCCESS: 07_fetch_population.py ---
2025-11-15 21:09:32,117 - INFO - 
============================================================
>>> RUNNING: 08_build_feature_matrix.py
============================================================
2025-11-15 21:09:34,440 - INFO - ============================================================
2025-11-15 21:09:34,440 - INFO - STEP 8: BUILD FEATURE MATRIX (SAMPLE)
2025-11-15 21:09:34,440 - INFO - ============================================================
2025-11-15 21:09:34,440 - INFO - Running temporal selection demonstration...
2025-11-15 21:09:34,492 - INFO - 
Logic Verification:
  observation_date selected_column_logic
0       2011-06-15     dist_road_2010_km
1       2016-03-20     dist_road_2015_km
2       2021-09-10     dist_road_2020_km
3       2024-11-01     dist_road_2025_km

2025-11-15 21:09:34,492 - INFO - Fetching sample matrix (Limit 10,000 rows)...
2025-11-15 21:09:37,654 - INFO -   Shape: (10000, 12)
2025-11-15 21:09:37,654 - INFO -   Columns: ['h3_index', 'geometry', 'period_start', 'period_end', 'population', 'dist_road_km', 'dist_city_km', 'dist_capital_km', 'dist_border_km', 'elevation_mean', 'slope_mean', 'terrain_ruggedness_mean']
2025-11-15 21:09:37,654 - INFO - ============================================================
2025-11-15 21:09:37,924 - INFO - --- SUCCESS: 08_build_feature_matrix.py ---
2025-11-15 21:09:37,924 - INFO - 
============================================================
2025-11-15 21:09:37,924 - INFO - PIPELINE COMPLETED SUCCESSFULLY.
2025-11-15 21:09:37,940 - INFO - All static features engineered and uploaded to PostGIS.
2025-11-15 21:09:37,940 - INFO - Logs available in: C:\Users\Brenan\Desktop\Thesis\Scratch\logs
2025-11-15 21:09:37,940 - INFO - ============================================================
2025-11-15 21:58:29,140 - INFO - 
--- MODULE 0: Verifying/Downloading GlobPop Data ---
2025-11-15 21:58:29,142 - INFO - Target directory: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison
2025-11-15 21:58:30,362 - INFO -   Downloading GlobPOP_2015.tif (123.1 MB)...
2025-11-15 21:58:46,130 - INFO -   Downloading GlobPOP_2016.tif (126.0 MB)...
2025-11-15 21:58:58,813 - INFO -   Downloading GlobPOP_2017.tif (125.2 MB)...
2025-11-15 21:59:11,884 - INFO -   Downloading GlobPOP_2018.tif (126.1 MB)...
2025-11-15 21:59:24,957 - INFO -   Downloading GlobPOP_2019.tif (124.3 MB)...
2025-11-15 21:59:37,821 - INFO -   Downloading GlobPOP_2020.tif (120.0 MB)...
2025-11-15 21:59:49,933 - INFO - Loading H3 grid geometry...
2025-11-15 21:59:50,190 - INFO - 
--- MODULE 1: Ingesting GlobPop (Years: [2015, 2016, 2017, 2018, 2019, 2020]) ---
2025-11-15 21:59:50,222 - INFO -   Processing 2015 (Zonal Stats on 15 cores)...
2025-11-15 22:00:02,511 - INFO -   Processing 2016 (Zonal Stats on 15 cores)...
2025-11-15 22:00:14,602 - INFO -   Processing 2017 (Zonal Stats on 15 cores)...
2025-11-15 22:00:26,471 - INFO -   Processing 2018 (Zonal Stats on 15 cores)...
2025-11-15 22:00:39,496 - INFO -   Processing 2019 (Zonal Stats on 15 cores)...
2025-11-15 22:00:52,339 - INFO -   Processing 2020 (Zonal Stats on 15 cores)...
2025-11-15 22:01:04,255 - INFO - 
--- MODULE 2: Running Comparison Analysis ---
2025-11-15 22:01:04,354 - INFO -   Year 2015: R²=0.0000, Total Diff=64,420,353,375
2025-11-15 22:01:04,356 - INFO -   Year 2016: R²=0.0000, Total Diff=64,420,400,486
2025-11-15 22:01:04,358 - INFO -   Year 2017: R²=0.0000, Total Diff=64,420,406,187
2025-11-15 22:01:04,360 - INFO -   Year 2018: R²=0.0000, Total Diff=64,420,262,277
2025-11-15 22:01:04,361 - INFO -   Year 2019: R²=0.0000, Total Diff=64,420,186,496
2025-11-15 22:01:04,362 - INFO -   Year 2020: R²=0.0000, Total Diff=64,420,008,002
2025-11-15 22:01:04,370 - INFO - 
Saved statistical summary to C:\Users\Brenan\Desktop\Thesis\Scratch\test\population_comparison_summary.csv
2025-11-15 22:01:04,370 - INFO - 
--- MODULE 3: Generating Visualizations ---
2025-11-15 22:01:04,383 - INFO -   Generating scatter plots...
2025-11-15 22:01:05,613 - INFO -   Generating difference maps...
2025-11-15 22:01:09,522 - INFO - 
Download and comparison complete. Check the 'test/' folder for plots.
2025-11-15 22:13:53,395 - INFO - 
--- MODULE 0: Verifying/Downloading GlobPop Data ---
2025-11-15 22:13:53,396 - INFO - Target directory: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison
2025-11-15 22:13:54,629 - INFO -   GlobPOP_2015.tif exists and is complete. Skipping.
2025-11-15 22:13:54,629 - INFO -   GlobPOP_2016.tif exists and is complete. Skipping.
2025-11-15 22:13:54,629 - INFO -   GlobPOP_2017.tif exists and is complete. Skipping.
2025-11-15 22:13:54,629 - INFO -   GlobPOP_2018.tif exists and is complete. Skipping.
2025-11-15 22:13:54,630 - INFO -   GlobPOP_2019.tif exists and is complete. Skipping.
2025-11-15 22:13:54,630 - INFO -   GlobPOP_2020.tif exists and is complete. Skipping.
2025-11-15 22:13:54,632 - INFO - Loading H3 grid geometry...
2025-11-15 22:13:54,739 - INFO - 
--- MODULE 1: Ingesting GlobPop (Years: [2015, 2016, 2017, 2018, 2019, 2020]) ---
2025-11-15 22:13:54,739 - WARNING - FORCE_REINGEST is True. Dropping table car_cewp.population_globpop_h3...
2025-11-15 22:13:54,761 - INFO -   Processing 2015 (Zonal Stats on 15 cores)...
2025-11-15 22:14:07,265 - INFO -   Processing 2016 (Zonal Stats on 15 cores)...
2025-11-15 22:14:18,967 - INFO -   Processing 2017 (Zonal Stats on 15 cores)...
2025-11-15 22:14:30,560 - INFO -   Processing 2018 (Zonal Stats on 15 cores)...
2025-11-15 22:14:42,351 - INFO -   Processing 2019 (Zonal Stats on 15 cores)...
2025-11-15 22:14:54,257 - INFO -   Processing 2020 (Zonal Stats on 15 cores)...
2025-11-15 22:15:06,015 - INFO - 
--- MODULE 2: Running Comparison Analysis ---
2025-11-15 22:15:06,079 - INFO -   Year 2015: R²=0.9461, Total Diff=-4,156,065
2025-11-15 22:15:06,082 - INFO -   Year 2016: R²=0.9434, Total Diff=-4,108,954
2025-11-15 22:15:06,085 - INFO -   Year 2017: R²=0.9415, Total Diff=-4,103,253
2025-11-15 22:15:06,087 - INFO -   Year 2018: R²=0.9438, Total Diff=-4,247,163
2025-11-15 22:15:06,089 - INFO -   Year 2019: R²=0.9415, Total Diff=-4,322,944
2025-11-15 22:15:06,091 - INFO -   Year 2020: R²=0.9375, Total Diff=-4,501,438
2025-11-15 22:15:06,098 - INFO - 
Saved statistical summary to C:\Users\Brenan\Desktop\Thesis\Scratch\test\population_comparison_summary.csv
2025-11-15 22:15:06,098 - INFO - 
--- MODULE 3: Generating Visualizations ---
2025-11-15 22:15:06,099 - ERROR - Analysis failed: module 'numpy' has no attribute 'int66'
Traceback (most recent call last):
  File "C:\Users\Brenan\Desktop\Thesis\Scratch\scripts\run_pop_comparison.py", line 476, in main
    visualize_comparison(df_compare, grid_gdf)
  File "C:\Users\Brenan\Desktop\Thesis\Scratch\scripts\run_pop_comparison.py", line 352, in visualize_comparison
    df_compare['h3_index_int'] = df_compare['h3_index'].astype(np.int66)
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\numpy\__init__.py", line 414, in __getattr__
    raise AttributeError("module {!r} has no attribute "
AttributeError: module 'numpy' has no attribute 'int66'
2025-11-15 22:16:55,430 - INFO - 
--- MODULE 0: Verifying/Downloading GlobPop Data ---
2025-11-15 22:16:55,430 - INFO - Target directory: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison
2025-11-15 22:16:57,208 - INFO -   GlobPOP_2015.tif exists and is complete. Skipping.
2025-11-15 22:16:57,208 - INFO -   GlobPOP_2016.tif exists and is complete. Skipping.
2025-11-15 22:16:57,208 - INFO -   GlobPOP_2017.tif exists and is complete. Skipping.
2025-11-15 22:16:57,209 - INFO -   GlobPOP_2018.tif exists and is complete. Skipping.
2025-11-15 22:16:57,209 - INFO -   GlobPOP_2019.tif exists and is complete. Skipping.
2025-11-15 22:16:57,209 - INFO -   GlobPOP_2020.tif exists and is complete. Skipping.
2025-11-15 22:16:57,211 - INFO - Loading H3 grid geometry...
2025-11-15 22:16:57,324 - INFO - 
--- MODULE 1: Ingesting GlobPop (Years: [2015, 2016, 2017, 2018, 2019, 2020]) ---
2025-11-15 22:16:57,325 - WARNING - FORCE_REINGEST is True. Dropping table car_cewp.population_globpop_h3...
2025-11-15 22:16:57,340 - INFO -   Processing 2015 (Zonal Stats on 15 cores)...
2025-11-15 22:17:10,379 - INFO -   Processing 2016 (Zonal Stats on 15 cores)...
2025-11-15 22:17:22,389 - INFO -   Processing 2017 (Zonal Stats on 15 cores)...
2025-11-15 22:17:34,618 - INFO -   Processing 2018 (Zonal Stats on 15 cores)...
2025-11-15 22:17:46,495 - INFO -   Processing 2019 (Zonal Stats on 15 cores)...
2025-11-15 22:17:58,352 - INFO -   Processing 2020 (Zonal Stats on 15 cores)...
2025-11-15 22:18:10,479 - INFO - 
--- MODULE 2: Running Comparison Analysis ---
2025-11-15 22:18:10,539 - INFO -   Year 2015: R²=0.9461, Total Diff=-4,156,065
2025-11-15 22:18:10,542 - INFO -   Year 2016: R²=0.9434, Total Diff=-4,108,954
2025-11-15 22:18:10,545 - INFO -   Year 2017: R²=0.9415, Total Diff=-4,103,253
2025-11-15 22:18:10,547 - INFO -   Year 2018: R²=0.9438, Total Diff=-4,247,163
2025-11-15 22:18:10,549 - INFO -   Year 2019: R²=0.9415, Total Diff=-4,322,944
2025-11-15 22:18:10,551 - INFO -   Year 2020: R²=0.9375, Total Diff=-4,501,438
2025-11-15 22:18:10,557 - INFO - 
Saved statistical summary to C:\Users\Brenan\Desktop\Thesis\Scratch\test\population_comparison_summary.csv
2025-11-15 22:18:10,557 - INFO - 
--- MODULE 3: Generating Visualizations ---
2025-11-15 22:18:10,569 - INFO -   Generating scatter plots...
2025-11-15 22:18:10,777 - ERROR - Analysis failed: Cannot take a larger sample than population when 'replace=False'
Traceback (most recent call last):
  File "C:\Users\Brenan\Desktop\Thesis\Scratch\scripts\run_pop_comparison.py", line 476, in main
    visualize_comparison(df_compare, grid_gdf)
  File "C:\Users\Brenan\Desktop\Thesis\Scratch\scripts\run_pop_comparison.py", line 375, in visualize_comparison
    year_data = gdf[gdf['year'] == year].sample(n=min(50000, len(gdf)), random_state=1)
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\pandas\core\generic.py", line 6140, in sample
    sampled_indices = sample.sample(obj_len, size, replace, weights, rs)
  File "C:\Users\Brenan\anaconda3\envs\geo_env\lib\site-packages\pandas\core\sample.py", line 152, in sample
    return random_state.choice(obj_len, size=size, replace=replace, p=weights).astype(
  File "numpy/random/mtrand.pyx", line 1020, in numpy.random.mtrand.RandomState.choice
ValueError: Cannot take a larger sample than population when 'replace=False'
2025-11-15 22:19:13,252 - INFO - 
--- MODULE 0: Verifying/Downloading GlobPop Data ---
2025-11-15 22:19:13,252 - INFO - Target directory: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison
2025-11-15 22:19:14,729 - INFO -   GlobPOP_2015.tif exists and is complete. Skipping.
2025-11-15 22:19:14,729 - INFO -   GlobPOP_2016.tif exists and is complete. Skipping.
2025-11-15 22:19:14,729 - INFO -   GlobPOP_2017.tif exists and is complete. Skipping.
2025-11-15 22:19:14,730 - INFO -   GlobPOP_2018.tif exists and is complete. Skipping.
2025-11-15 22:19:14,730 - INFO -   GlobPOP_2019.tif exists and is complete. Skipping.
2025-11-15 22:19:14,730 - INFO -   GlobPOP_2020.tif exists and is complete. Skipping.
2025-11-15 22:19:14,732 - INFO - Loading H3 grid geometry...
2025-11-15 22:19:14,839 - INFO - 
--- MODULE 1: Ingesting GlobPop (Years: [2015, 2016, 2017, 2018, 2019, 2020]) ---
2025-11-15 22:19:14,839 - WARNING - FORCE_REINGEST is True. Dropping table car_cewp.population_globpop_h3...
2025-11-15 22:19:14,853 - INFO -   Processing 2015 (Zonal Stats on 15 cores)...
2025-11-15 22:19:26,600 - INFO -   Processing 2016 (Zonal Stats on 15 cores)...
2025-11-15 22:19:38,863 - INFO -   Processing 2017 (Zonal Stats on 15 cores)...
2025-11-15 22:19:50,765 - INFO -   Processing 2018 (Zonal Stats on 15 cores)...
2025-11-15 22:20:03,067 - INFO -   Processing 2019 (Zonal Stats on 15 cores)...
2025-11-15 22:20:15,154 - INFO -   Processing 2020 (Zonal Stats on 15 cores)...
2025-11-15 22:20:27,547 - INFO - 
--- MODULE 2: Running Comparison Analysis ---
2025-11-15 22:20:27,602 - INFO -   Year 2015: R²=0.9461, Total Diff=-4,156,065
2025-11-15 22:20:27,605 - INFO -   Year 2016: R²=0.9434, Total Diff=-4,108,954
2025-11-15 22:20:27,607 - INFO -   Year 2017: R²=0.9415, Total Diff=-4,103,253
2025-11-15 22:20:27,609 - INFO -   Year 2018: R²=0.9438, Total Diff=-4,247,163
2025-11-15 22:20:27,612 - INFO -   Year 2019: R²=0.9415, Total Diff=-4,322,944
2025-11-15 22:20:27,614 - INFO -   Year 2020: R²=0.9375, Total Diff=-4,501,438
2025-11-15 22:20:27,621 - INFO - 
Saved statistical summary to C:\Users\Brenan\Desktop\Thesis\Scratch\test\population_comparison_summary.csv
2025-11-15 22:20:27,622 - INFO - 
--- MODULE 3: Generating Visualizations ---
2025-11-15 22:20:27,630 - INFO -   Generating scatter plots...
2025-11-15 22:20:30,792 - INFO -   Generating difference maps...
2025-11-15 22:20:34,781 - INFO - 
Download and comparison complete. Check the 'test/' folder for plots.
2025-11-15 22:46:23,754 - INFO - 
--- MODULE 0a: Verifying/Downloading GlobPop Data ---
2025-11-15 22:46:23,754 - INFO - Target directory: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison
2025-11-15 22:46:25,329 - INFO -   GlobPOP_2015.tif exists and is complete. Skipping.
2025-11-15 22:46:25,329 - INFO -   GlobPOP_2016.tif exists and is complete. Skipping.
2025-11-15 22:46:25,329 - INFO -   GlobPOP_2017.tif exists and is complete. Skipping.
2025-11-15 22:46:25,329 - INFO -   GlobPOP_2018.tif exists and is complete. Skipping.
2025-11-15 22:46:25,329 - INFO -   GlobPOP_2019.tif exists and is complete. Skipping.
2025-11-15 22:46:25,330 - INFO -   GlobPOP_2020.tif exists and is complete. Skipping.
2025-11-15 22:46:25,331 - INFO - 
--- MODULE 0b: Verifying/Downloading WorldPop v1 Data ---
2025-11-15 22:46:25,331 - INFO - Target directory: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison
2025-11-15 22:46:28,887 - INFO - Loading H3 grid geometry...
2025-11-15 22:46:28,996 - INFO - 
--- MODULE 1: Ingesting population_globpop_h3 (Years: [2015, 2016, 2017, 2018, 2019, 2020]) ---
2025-11-15 22:46:28,997 - WARNING - FORCE_REINGEST is True. Dropping table car_cewp.population_globpop_h3...
2025-11-15 22:46:29,010 - INFO -   Processing 2015 (Zonal Stats on 15 cores)...
2025-11-15 22:46:40,797 - INFO -   Processing 2016 (Zonal Stats on 15 cores)...
2025-11-15 22:46:52,555 - INFO -   Processing 2017 (Zonal Stats on 15 cores)...
2025-11-15 22:47:03,981 - INFO -   Processing 2018 (Zonal Stats on 15 cores)...
2025-11-15 22:47:15,642 - INFO -   Processing 2019 (Zonal Stats on 15 cores)...
2025-11-15 22:47:27,965 - INFO -   Processing 2020 (Zonal Stats on 15 cores)...
2025-11-15 22:47:39,760 - INFO - 
--- MODULE 1: Ingesting population_worldpop_v1_h3 (Years: [2015, 2016, 2017, 2018, 2019, 2020]) ---
2025-11-15 22:47:39,761 - WARNING - FORCE_REINGEST is True. Dropping table car_cewp.population_worldpop_v1_h3...
2025-11-15 22:47:39,768 - WARNING -   File not found: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison\WP_v1_2015.tif. Skipping year 2015.
2025-11-15 22:47:39,768 - WARNING -   File not found: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison\WP_v1_2016.tif. Skipping year 2016.
2025-11-15 22:47:39,769 - WARNING -   File not found: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison\WP_v1_2017.tif. Skipping year 2017.
2025-11-15 22:47:39,770 - WARNING -   File not found: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison\WP_v1_2018.tif. Skipping year 2018.
2025-11-15 22:47:39,770 - WARNING -   File not found: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison\WP_v1_2019.tif. Skipping year 2019.
2025-11-15 22:47:39,771 - WARNING -   File not found: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison\WP_v1_2020.tif. Skipping year 2020.
2025-11-15 22:47:39,771 - INFO - 
--- MODULE 2: Running 3-Way Comparison Analysis ---
2025-11-15 22:47:39,874 - INFO -   Year 2015: Total_WP_v2=4,650,523, Total_GlobPop=8,806,588, Total_WP_v1=0
2025-11-15 22:47:39,876 - INFO -   Year 2016: Total_WP_v2=4,730,445, Total_GlobPop=8,839,399, Total_WP_v1=0
2025-11-15 22:47:39,878 - INFO -   Year 2017: Total_WP_v2=4,821,441, Total_GlobPop=8,924,694, Total_WP_v1=0
2025-11-15 22:47:39,880 - INFO -   Year 2018: Total_WP_v2=4,892,244, Total_GlobPop=9,139,407, Total_WP_v1=0
2025-11-15 22:47:39,882 - INFO -   Year 2019: Total_WP_v2=4,993,972, Total_GlobPop=9,316,916, Total_WP_v1=0
2025-11-15 22:47:39,884 - INFO -   Year 2020: Total_WP_v2=5,026,070, Total_GlobPop=9,527,508, Total_WP_v1=0
2025-11-15 22:47:39,892 - INFO - 
Saved statistical summary to C:\Users\Brenan\Desktop\Thesis\Scratch\test\population_comparison_summary_3way.csv
2025-11-15 22:47:39,892 - INFO - 
--- MODULE 3: Generating Visualizations ---
2025-11-15 22:47:39,906 - INFO -   Generating scatter plots (WP_v2 vs. GlobPop)...
2025-11-15 22:47:43,022 - INFO -   Generating scatter plots (WP_v2 vs. WP_v1)...
2025-11-15 22:47:45,941 - INFO -   Generating difference maps (WP_v2 vs. GlobPop)...
2025-11-15 22:47:49,738 - INFO -   Generating difference maps (WP_v2 vs. WP_v1)...
2025-11-15 22:47:53,503 - INFO - 
Download and comparison complete. Check the 'test/' folder for plots.
2025-11-15 22:55:20,926 - INFO - 
--- MODULE 0a: Verifying/Downloading GlobPop Data ---
2025-11-15 22:55:20,926 - INFO - Target directory: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison
2025-11-15 22:55:22,473 - INFO - 
--- MODULE 0b: Verifying/Downloading WorldPop v1 Data ---
2025-11-15 22:55:22,473 - INFO - Target directory: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison
2025-11-15 22:55:26,731 - INFO - Loading H3 grid geometry...
2025-11-15 22:55:26,933 - INFO - 
--- MODULE 1: Ingesting population_globpop_h3 (Years: [2015, 2016, 2017, 2018, 2019, 2020]) ---
2025-11-15 22:55:26,960 - INFO -   'population_globpop_h3' TIF CRS found: EPSG:4326
2025-11-15 22:55:26,961 - INFO -   CRS match. No reprojection needed.
2025-11-15 22:55:26,961 - WARNING - FORCE_REINGEST is True. Dropping table car_cewp.population_globpop_h3...
2025-11-15 22:55:26,987 - INFO -   Processing 2015 (Zonal Stats on 15 cores)...
2025-11-15 22:55:40,473 - INFO -   Processing 2016 (Zonal Stats on 15 cores)...
2025-11-15 22:55:51,829 - INFO -   Processing 2017 (Zonal Stats on 15 cores)...
2025-11-15 22:56:03,780 - INFO -   Processing 2018 (Zonal Stats on 15 cores)...
2025-11-15 22:56:15,672 - INFO -   Processing 2019 (Zonal Stats on 15 cores)...
2025-11-15 22:56:27,202 - INFO -   Processing 2020 (Zonal Stats on 15 cores)...
2025-11-15 22:56:40,352 - INFO - 
--- MODULE 1: Ingesting population_worldpop_v1_h3 (Years: [2015, 2016, 2017, 2018, 2019, 2020]) ---
2025-11-15 22:56:40,352 - ERROR - File not found: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison\WP_v1_2015.tif. Cannot determine CRS.
2025-11-15 22:56:40,353 - INFO - 
--- MODULE 2: Running 3-Way Comparison Analysis ---
2025-11-15 22:56:40,431 - INFO -   Year 2015: Total_WP_v2=4,650,523, Total_GlobPop=8,806,588, Total_WP_v1=0
2025-11-15 22:56:40,433 - INFO -   Year 2016: Total_WP_v2=4,730,445, Total_GlobPop=8,839,399, Total_WP_v1=0
2025-11-15 22:56:40,436 - INFO -   Year 2017: Total_WP_v2=4,821,441, Total_GlobPop=8,924,694, Total_WP_v1=0
2025-11-15 22:56:40,438 - INFO -   Year 2018: Total_WP_v2=4,892,244, Total_GlobPop=9,139,407, Total_WP_v1=0
2025-11-15 22:56:40,440 - INFO -   Year 2019: Total_WP_v2=4,993,972, Total_GlobPop=9,316,916, Total_WP_v1=0
2025-11-15 22:56:40,443 - INFO -   Year 2020: Total_WP_v2=5,026,070, Total_GlobPop=9,527,508, Total_WP_v1=0
2025-11-15 22:56:40,451 - INFO - 
Saved statistical summary to C:\Users\Brenan\Desktop\Thesis\Scratch\test\population_comparison_summary_3way.csv
2025-11-15 22:56:40,451 - INFO - 
--- MODULE 3: Generating Visualizations ---
2025-11-15 22:56:40,461 - INFO -   Generating scatter plots (WP_v2 vs. GlobPop)...
2025-11-15 22:56:44,550 - INFO -   Generating scatter plots (WP_v2 vs. WP_v1)...
2025-11-15 22:56:48,292 - INFO -   Generating difference maps (WP_v2 vs. GlobPop)...
2025-11-15 22:56:53,457 - INFO -   Generating difference maps (WP_v2 vs. WP_v1)...
2025-11-15 22:56:58,604 - INFO - 
Download and comparison complete. Check the 'test/' folder for plots.
2025-11-16 00:10:45,126 - INFO - 
--- MODULE 0a: Verifying/Downloading GlobPop Data ---
2025-11-16 00:10:46,035 - INFO - 
--- MODULE 0b: Verifying/Downloading WorldPop v1 Data ---
2025-11-16 00:10:47,191 - INFO - Loading H3 grid geometry...
2025-11-16 00:10:47,562 - INFO - 
--- MODULE 1: Ingesting population_globpop_h3 (Years: [2015, 2016, 2017, 2018, 2019, 2020]) ---
2025-11-16 00:10:47,578 - INFO -   Year 2015 already in DB. Skipping ingest.
2025-11-16 00:10:47,580 - INFO -   Year 2016 already in DB. Skipping ingest.
2025-11-16 00:10:47,581 - INFO -   Year 2017 already in DB. Skipping ingest.
2025-11-16 00:10:47,582 - INFO -   Year 2018 already in DB. Skipping ingest.
2025-11-16 00:10:47,584 - INFO -   Year 2019 already in DB. Skipping ingest.
2025-11-16 00:10:47,585 - INFO -   Year 2020 already in DB. Skipping ingest.
2025-11-16 00:10:47,586 - INFO - 
--- MODULE 1: Ingesting population_worldpop_v1_h3 (Years: [2015, 2016, 2017, 2018, 2019, 2020]) ---
2025-11-16 00:10:47,586 - WARNING - FORCE_REINGEST is True. Dropping table car_cewp.population_worldpop_v1_h3...
2025-11-16 00:10:47,624 - WARNING -   File not found: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison\WP_v1_2015.tif. Skipping year 2015.
2025-11-16 00:10:47,625 - WARNING -   File not found: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison\WP_v1_2016.tif. Skipping year 2016.
2025-11-16 00:10:47,626 - WARNING -   File not found: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison\WP_v1_2017.tif. Skipping year 2017.
2025-11-16 00:10:47,627 - WARNING -   File not found: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison\WP_v1_2018.tif. Skipping year 2018.
2025-11-16 00:10:47,628 - WARNING -   File not found: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison\WP_v1_2019.tif. Skipping year 2019.
2025-11-16 00:10:47,629 - WARNING -   File not found: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison\WP_v1_2020.tif. Skipping year 2020.
2025-11-16 00:10:47,630 - INFO - 
--- MODULE 2: Running 3-Way Comparison Analysis ---
2025-11-16 00:10:47,926 - INFO -   Year 2015: Total_WP_v2=4,650,523, Total_GlobPop=8,806,588, Total_WP_v1=0
2025-11-16 00:10:47,931 - INFO -   Year 2016: Total_WP_v2=4,730,445, Total_GlobPop=8,839,399, Total_WP_v1=0
2025-11-16 00:10:47,936 - INFO -   Year 2017: Total_WP_v2=4,821,441, Total_GlobPop=8,924,694, Total_WP_v1=0
2025-11-16 00:10:47,939 - INFO -   Year 2018: Total_WP_v2=4,892,244, Total_GlobPop=9,139,407, Total_WP_v1=0
2025-11-16 00:10:47,942 - INFO -   Year 2019: Total_WP_v2=4,993,972, Total_GlobPop=9,316,916, Total_WP_v1=0
2025-11-16 00:10:47,945 - INFO -   Year 2020: Total_WP_v2=5,026,070, Total_GlobPop=9,527,508, Total_WP_v1=0
2025-11-16 00:10:47,958 - INFO - 
Saved statistical summary to C:\Users\Brenan\Desktop\Thesis\Scratch\test\population_comparison_summary_3way.csv
2025-11-16 00:10:47,960 - INFO - 
--- MODULE 3: Generating Visualizations ---
2025-11-16 00:10:47,991 - INFO -   Generating scatter plots (WP_v2 vs. GlobPop)...
2025-11-16 00:10:52,833 - INFO -   Generating scatter plots (WP_v2 vs. WP_v1)...
2025-11-16 00:10:56,927 - INFO -   Generating difference maps (WP_v2 vs. GlobPop)...
2025-11-16 00:11:02,466 - INFO -   Generating difference maps (WP_v2 vs. WP_v1)...
2025-11-16 00:11:07,845 - INFO - 
Download and comparison complete. Check the 'test/' folder for plots.
2025-11-16 00:33:17,339 - INFO - 
--- MODULE 0a: Verifying/Downloading GlobPop Data ---
2025-11-16 00:33:18,861 - INFO - 
--- MODULE 0b: Verifying/Downloading WorldPop v1 Data ---
2025-11-16 00:33:22,807 - INFO - Loading H3 grid geometry...
2025-11-16 00:33:23,025 - INFO - 
--- MODULE 1: Ingesting population_globpop_h3 (Years: [2015, 2016, 2017, 2018, 2019, 2020]) ---
2025-11-16 00:33:23,033 - INFO -   Year 2015 already in DB. Skipping ingest.
2025-11-16 00:33:23,035 - INFO -   Year 2016 already in DB. Skipping ingest.
2025-11-16 00:33:23,036 - INFO -   Year 2017 already in DB. Skipping ingest.
2025-11-16 00:33:23,038 - INFO -   Year 2018 already in DB. Skipping ingest.
2025-11-16 00:33:23,039 - INFO -   Year 2019 already in DB. Skipping ingest.
2025-11-16 00:33:23,041 - INFO -   Year 2020 already in DB. Skipping ingest.
2025-11-16 00:33:23,042 - INFO - 
--- MODULE 1: Ingesting population_worldpop_v1_h3 (Years: [2015, 2016, 2017, 2018, 2019, 2020]) ---
2025-11-16 00:33:23,043 - WARNING - FORCE_REINGEST is True. Dropping table car_cewp.population_worldpop_v1_h3...
2025-11-16 00:33:23,069 - WARNING -   File not found: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison\WP_v1_2015.tif. Skipping year 2015.
2025-11-16 00:33:23,070 - WARNING -   File not found: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison\WP_v1_2016.tif. Skipping year 2016.
2025-11-16 00:33:23,071 - WARNING -   File not found: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison\WP_v1_2017.tif. Skipping year 2017.
2025-11-16 00:33:23,072 - WARNING -   File not found: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison\WP_v1_2018.tif. Skipping year 2018.
2025-11-16 00:33:23,073 - WARNING -   File not found: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison\WP_v1_2019.tif. Skipping year 2019.
2025-11-16 00:33:23,074 - WARNING -   File not found: C:\Users\Brenan\Desktop\Thesis\Scratch\data\raw\worldpop_comparison\WP_v1_2020.tif. Skipping year 2020.
2025-11-16 00:33:23,075 - INFO - 
--- MODULE 2: Running 3-Way Comparison Analysis ---
2025-11-16 00:33:23,309 - INFO -   Year 2015: Total_WP_v2=4,650,523, Total_GlobPop=8,806,588, Total_WP_v1=0
2025-11-16 00:33:23,313 - INFO -   Year 2016: Total_WP_v2=4,730,445, Total_GlobPop=8,839,399, Total_WP_v1=0
2025-11-16 00:33:23,317 - INFO -   Year 2017: Total_WP_v2=4,821,441, Total_GlobPop=8,924,694, Total_WP_v1=0
2025-11-16 00:33:23,319 - INFO -   Year 2018: Total_WP_v2=4,892,244, Total_GlobPop=9,139,407, Total_WP_v1=0
2025-11-16 00:33:23,322 - INFO -   Year 2019: Total_WP_v2=4,993,972, Total_GlobPop=9,316,916, Total_WP_v1=0
2025-11-16 00:33:23,325 - INFO -   Year 2020: Total_WP_v2=5,026,070, Total_GlobPop=9,527,508, Total_WP_v1=0
2025-11-16 00:33:23,337 - INFO - 
Saved statistical summary to C:\Users\Brenan\Desktop\Thesis\Scratch\test\population_comparison_summary_3way.csv
2025-11-16 00:33:23,338 - INFO - 
--- MODULE 3: Generating Visualizations ---
2025-11-16 00:33:23,355 - INFO -   Generating scatter plots (WP_v2 vs. GlobPop)...
2025-11-16 00:33:28,185 - INFO -   Generating scatter plots (WP_v2 vs. WP_v1)...
2025-11-16 00:33:32,110 - INFO -   Generating difference maps (WP_v2 vs. GlobPop)...
2025-11-16 00:33:36,906 - INFO -   Generating difference maps (WP_v2 vs. WP_v1)...
2025-11-16 00:33:41,594 - INFO - 
Download and comparison complete. Check the 'test/' folder for plots.
2025-11-16 00:36:15,121 - INFO - 
--- MODULE 0a: Verifying/Downloading GlobPop Data ---
2025-11-16 00:36:16,440 - INFO - 
--- MODULE 0b: Verifying/Downloading WorldPop v1 (CAF) Data ---
2025-11-16 00:36:17,239 - INFO -   Downloading WP_v1_2015.tif (271.3 MB)...
2025-11-16 00:49:17,480 - INFO - 
--- MODULE 0a: Verifying/Downloading GlobPop Data ---
2025-11-16 00:49:17,481 - INFO - 
--- MODULE 0b: Importing WorldPop v1 from Local Drive ---
2025-11-16 00:49:17,481 - INFO - Source: C:\Users\Brenan\Downloads
2025-11-16 00:49:21,889 - INFO - Loading Grid...
2025-11-16 00:49:22,239 - INFO - 
--- MODULE 1: Ingesting population_globpop_h3 ---
2025-11-16 00:49:22,264 - INFO - 
--- MODULE 1: Ingesting population_worldpop_v1_h3 ---
2025-11-16 00:49:22,265 - WARNING - FORCE_REINGEST=True. Dropping car_cewp.population_worldpop_v1_h3...
2025-11-16 00:49:22,314 - INFO -   Processing 2015 (Clipping & Zonal Stats)...
2025-11-16 00:49:52,603 - INFO -   Processing 2016 (Clipping & Zonal Stats)...
2025-11-16 00:50:20,672 - INFO -   Processing 2017 (Clipping & Zonal Stats)...
2025-11-16 00:50:47,442 - INFO -   Processing 2018 (Clipping & Zonal Stats)...
2025-11-16 00:51:15,347 - INFO -   Processing 2019 (Clipping & Zonal Stats)...
2025-11-16 00:51:45,646 - INFO -   Processing 2020 (Clipping & Zonal Stats)...
2025-11-16 00:56:49,262 - INFO - 
--- MODULE 2: Running 3-Way Comparison ---
2025-11-16 00:56:49,503 - INFO - 
--- MODULE 3: Visualization ---
2025-11-16 00:56:53,373 - INFO - Done. Results in 'test/' folder.
2025-11-16 01:02:07,975 - INFO - 
--- MODULE 0a: Verifying/Downloading GlobPop Data ---
2025-11-16 01:02:07,976 - INFO - 
--- MODULE 0b: Importing WorldPop v1 from Local Drive ---
2025-11-16 01:02:07,977 - INFO - Source: C:\Users\Brenan\Downloads
2025-11-16 01:02:07,982 - INFO - Loading Grid...
2025-11-16 01:02:08,199 - INFO - 
--- MODULE 1: Ingesting population_globpop_h3 ---
2025-11-16 01:02:08,211 - INFO - 
--- MODULE 1: Ingesting population_worldpop_v1_h3 ---
2025-11-16 01:02:08,212 - WARNING - FORCE_REINGEST=True. Dropping car_cewp.population_worldpop_v1_h3...
2025-11-16 01:02:08,234 - INFO -   Processing 2015 (Clipping & Zonal Stats)...
2025-11-16 01:02:37,524 - INFO -   Processing 2016 (Clipping & Zonal Stats)...
2025-11-16 01:03:05,193 - INFO -   Processing 2017 (Clipping & Zonal Stats)...
2025-11-16 01:03:34,588 - INFO -   Processing 2018 (Clipping & Zonal Stats)...
2025-11-16 01:04:07,588 - INFO -   Processing 2019 (Clipping & Zonal Stats)...
2025-11-16 01:04:47,700 - INFO -   Processing 2020 (Clipping & Zonal Stats)...
2025-11-16 01:05:28,135 - INFO - 
--- MODULE 2: Running 3-Way Comparison ---
2025-11-16 01:05:28,450 - INFO - 
--- MODULE 3: Visualization ---
2025-11-16 01:05:33,678 - INFO - Done. Results in 'test/' folder.
